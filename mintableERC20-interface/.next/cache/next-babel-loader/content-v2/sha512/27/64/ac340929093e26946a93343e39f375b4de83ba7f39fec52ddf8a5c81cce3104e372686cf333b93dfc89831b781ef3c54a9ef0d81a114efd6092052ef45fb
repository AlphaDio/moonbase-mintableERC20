{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"/home/alberto/data/mintableERC20/mintableERC20-interface/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/alberto/data/mintableERC20/mintableERC20-interface/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/home/alberto/data/mintableERC20/mintableERC20-interface/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/alberto/data/mintableERC20/mintableERC20-interface/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/home/alberto/data/mintableERC20/mintableERC20-interface/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/home/alberto/data/mintableERC20/mintableERC20-interface/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/home/alberto/data/mintableERC20/mintableERC20-interface/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/alberto/data/mintableERC20/mintableERC20-interface/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"/home/alberto/data/mintableERC20/mintableERC20-interface/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from 'react';\nimport { Button, Form, Message } from 'semantic-ui-react';\nimport BMRInstance from '../ethereum/bmr';\n\nvar jobids = require('../ethereum/jobid');\n\nvar Table = /*#__PURE__*/function (_Component) {\n  _inherits(Table, _Component);\n\n  var _super = _createSuper(Table);\n\n  function Table() {\n    var _this;\n\n    _classCallCheck(this, Table);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      jobid: '',\n      value: 'N/A',\n      updated: 'N/A',\n      lastJobID: 'N/A',\n      loading: false,\n      errorMessage: ''\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onSubmit\", /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(event) {\n        var clientAddress, contractInstance, i, check;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                event.preventDefault();\n\n                _this.setState({\n                  loading: true,\n                  errorMessage: ''\n                }); // Check Metamask and Chain ID\n\n\n                if (!(typeof window.ethereum !== 'undefined' && ethereum.chainId === '0x507')) {\n                  _context.next = 44;\n                  break;\n                }\n\n                // Contract info\n                clientAddress = '0x61b116Bd1ee0706e146816e383014497080937f1';\n                contractInstance = BMRInstance(clientAddress, 1); // Hack to reset state of contract\n\n                if (!(_this.state.jobid === 'moonlinkreset')) {\n                  _context.next = 18;\n                  break;\n                }\n\n                _context.prev = 6;\n                _context.next = 9;\n                return contractInstance.forceToTrue();\n\n              case 9:\n                _context.next = 14;\n                break;\n\n              case 11:\n                _context.prev = 11;\n                _context.t0 = _context[\"catch\"](6);\n\n                _this.setState({\n                  loading: false,\n                  errorMessage: _context.t0.message\n                });\n\n              case 14:\n                _this.setState({\n                  loading: false\n                });\n\n                return _context.abrupt(\"return\");\n\n              case 18:\n                _context.t1 = _regeneratorRuntime.keys(jobids);\n\n              case 19:\n                if ((_context.t2 = _context.t1()).done) {\n                  _context.next = 41;\n                  break;\n                }\n\n                i = _context.t2.value;\n\n                if (!(jobids[i] === _this.state.jobid)) {\n                  _context.next = 39;\n                  break;\n                }\n\n                _context.next = 24;\n                return contractInstance.fulfillCheck();\n\n              case 24:\n                check = _context.sent;\n\n                if (!check) {\n                  _context.next = 36;\n                  break;\n                }\n\n                _context.prev = 26;\n                _context.next = 29;\n                return contractInstance.requestPrice(_this.state.jobid);\n\n              case 29:\n                _context.next = 34;\n                break;\n\n              case 31:\n                _context.prev = 31;\n                _context.t3 = _context[\"catch\"](26);\n\n                _this.setState({\n                  loading: false,\n                  errorMessage: _context.t3.message\n                });\n\n              case 34:\n                _context.next = 37;\n                break;\n\n              case 36:\n                _this.setState({\n                  loading: false,\n                  errorMessage: \"Request \".concat(_this.state.lastJobID, \" ongoing. Please wait until it is fulfilled\")\n                });\n\n              case 37:\n                _this.setState({\n                  loading: false\n                });\n\n                return _context.abrupt(\"return\");\n\n              case 39:\n                _context.next = 19;\n                break;\n\n              case 41:\n                // Error message because JobId not in the list\n                _this.setState({\n                  loading: false,\n                  errorMessage: 'Job ID not supported'\n                });\n\n              case 42:\n                _context.next = 45;\n                break;\n\n              case 44:\n                // Error message because MetaMask not found or Network Id not correct\n                _this.setState({\n                  loading: false,\n                  errorMessage: 'Please install MetaMask or connect it to Moonbase Alpha'\n                });\n\n              case 45:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[6, 11], [26, 31]]);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"getValue\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var currentdate, clientAddress, contractInstance, value, lastJobID, lastBlockTime, epoch, date;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              // Date\n              currentdate = new Date(); // Contract Fetch\n\n              clientAddress = '0x61b116Bd1ee0706e146816e383014497080937f1';\n              contractInstance = BMRInstance(clientAddress, 0);\n              _context2.next = 6;\n              return contractInstance.currentPrice();\n\n            case 6:\n              _context2.t0 = _context2.sent;\n              value = _context2.t0 / 100;\n\n              if (!(value != _this.state.value)) {\n                _context2.next = 18;\n                break;\n              }\n\n              _context2.next = 11;\n              return contractInstance.lastJobId();\n\n            case 11:\n              lastJobID = _context2.sent;\n              _context2.next = 14;\n              return contractInstance.lastBlockTime();\n\n            case 14:\n              lastBlockTime = _context2.sent;\n              epoch = new Date(lastBlockTime.toNumber() * 1000);\n              date = \"\".concat(epoch.getFullYear(), \"/\\n            \").concat(('00' + (epoch.getMonth() + 1)).slice(-2), \"/\\n            \").concat(('00' + epoch.getDate()).slice(-2), \" -- \\n            \").concat(('00' + epoch.getHours()).slice(-2), \":\\n            \").concat(('00' + epoch.getMinutes()).slice(-2), \":\\n            \").concat(('00' + epoch.getSeconds()).slice(-2)); // Update value, time and lastJobID\n\n              _this.setState({\n                value: value.toString(),\n                updated: date,\n                lastJobID: lastJobID\n              });\n\n            case 18:\n              _this.intervalID = setTimeout(_this.getValue.bind(_assertThisInitialized(_this)), 5000);\n              _context2.next = 24;\n              break;\n\n            case 21:\n              _context2.prev = 21;\n              _context2.t1 = _context2[\"catch\"](0);\n              console.log(_context2.t1);\n\n            case 24:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 21]]);\n    })));\n\n    return _this;\n  }\n\n  _createClass(Table, [{\n    key: \"componentDidMount\",\n    value: function () {\n      var _componentDidMount = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                this.getValue();\n\n              case 1:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function componentDidMount() {\n        return _componentDidMount.apply(this, arguments);\n      }\n\n      return componentDidMount;\n    }()\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      clearInterval(this.intervalID);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return /*#__PURE__*/_jsxs(\"div\", {\n        children: [/*#__PURE__*/_jsx(\"h3\", {\n          children: \"Basic Request Model\"\n        }), /*#__PURE__*/_jsxs(\"p\", {\n          children: [\"Request a specific price data to an Oracle Node in the Moonbase Alpha TestNet. \", /*#__PURE__*/_jsx(\"br\", {}), \" The value is stored in a contract that is displayed in this dashboard.\"]\n        }), /*#__PURE__*/_jsxs(\"h5\", {\n          children: [\"Current Value: $ \", this.state.value, \" (Last Updated:\", ' ', this.state.updated, \" -- JobID: \", this.state.lastJobID, \")\"]\n        }), /*#__PURE__*/_jsxs(Form, {\n          onSubmit: this.onSubmit,\n          error: !!this.state.errorMessage,\n          children: [/*#__PURE__*/_jsxs(Form.Field, {\n            children: [/*#__PURE__*/_jsx(\"label\", {\n              children: \"Enter Job ID:\"\n            }), /*#__PURE__*/_jsx(\"input\", {\n              placeholder: \"Job ID\",\n              value: this.state.jobid,\n              onChange: function onChange(event) {\n                return _this2.setState({\n                  jobid: event.target.value\n                });\n              }\n            })]\n          }), /*#__PURE__*/_jsx(Message, {\n            error: true,\n            header: \"Oops!\",\n            content: this.state.errorMessage\n          }), /*#__PURE__*/_jsx(Button, {\n            type: \"submit\",\n            loading: this.state.loading,\n            primary: true,\n            children: \"Submit Tx\"\n          })]\n        }), /*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsxs(\"table\", {\n          className: \"ui celled table\",\n          children: [/*#__PURE__*/_jsx(\"thead\", {\n            children: /*#__PURE__*/_jsxs(\"tr\", {\n              children: [/*#__PURE__*/_jsx(\"th\", {\n                children: \"Token Pair\"\n              }), /*#__PURE__*/_jsx(\"th\", {\n                children: \"Job ID\"\n              })]\n            })\n          }), /*#__PURE__*/_jsx(\"tbody\", {\n            children: /*#__PURE__*/_jsxs(\"tr\", {\n              children: [/*#__PURE__*/_jsx(\"td\", {\n                \"data-label\": \"Token Pair\",\n                children: \"BTC/USD\"\n              }), /*#__PURE__*/_jsx(\"td\", {\n                \"data-label\": \"Job ID\",\n                children: \"0a1d7df6a47c417bb4d0ab561a37753e\"\n              })]\n            })\n          }), /*#__PURE__*/_jsx(\"tbody\", {\n            children: /*#__PURE__*/_jsxs(\"tr\", {\n              children: [/*#__PURE__*/_jsx(\"td\", {\n                \"data-label\": \"Token Pair\",\n                children: \"ETH/USD\"\n              }), /*#__PURE__*/_jsx(\"td\", {\n                \"data-label\": \"Job ID\",\n                children: \"ddd85cc4bab24920bc7c605b5bed3bf0\"\n              })]\n            })\n          }), /*#__PURE__*/_jsx(\"tbody\", {\n            children: /*#__PURE__*/_jsxs(\"tr\", {\n              children: [/*#__PURE__*/_jsx(\"td\", {\n                \"data-label\": \"Token Pair\",\n                children: \"DOT/USD\"\n              }), /*#__PURE__*/_jsx(\"td\", {\n                \"data-label\": \"Job ID\",\n                children: \"93790efc1e7641a99465ea8b1c71ce7a\"\n              })]\n            })\n          }), /*#__PURE__*/_jsx(\"tbody\", {\n            children: /*#__PURE__*/_jsxs(\"tr\", {\n              children: [/*#__PURE__*/_jsx(\"td\", {\n                \"data-label\": \"Token Pair\",\n                children: \"KSM/USD\"\n              }), /*#__PURE__*/_jsx(\"td\", {\n                \"data-label\": \"Job ID\",\n                children: \"d37d9a18f92f49198ceece6d367ed77a\"\n              })]\n            })\n          }), /*#__PURE__*/_jsx(\"tbody\", {\n            children: /*#__PURE__*/_jsxs(\"tr\", {\n              children: [/*#__PURE__*/_jsx(\"td\", {\n                \"data-label\": \"Token Pair\",\n                children: \"AAVE/USD\"\n              }), /*#__PURE__*/_jsx(\"td\", {\n                \"data-label\": \"Job ID\",\n                children: \"684981fa8e264cc1afa3e1df7fe8eecc\"\n              })]\n            })\n          }), /*#__PURE__*/_jsx(\"tbody\", {\n            children: /*#__PURE__*/_jsxs(\"tr\", {\n              children: [/*#__PURE__*/_jsx(\"td\", {\n                \"data-label\": \"Token Pair\",\n                children: \"ALGO/USD\"\n              }), /*#__PURE__*/_jsx(\"td\", {\n                \"data-label\": \"Job ID\",\n                children: \"f7a442a6365048799a30c02ac56f4440\"\n              })]\n            })\n          }), /*#__PURE__*/_jsx(\"tbody\", {\n            children: /*#__PURE__*/_jsxs(\"tr\", {\n              children: [/*#__PURE__*/_jsx(\"td\", {\n                \"data-label\": \"Token Pair\",\n                children: \"BAND/USD\"\n              }), /*#__PURE__*/_jsx(\"td\", {\n                \"data-label\": \"Job ID\",\n                children: \"6daa1fe7ba7d421a8a76fa6c2adb1382\"\n              })]\n            })\n          }), /*#__PURE__*/_jsx(\"tbody\", {\n            children: /*#__PURE__*/_jsxs(\"tr\", {\n              children: [/*#__PURE__*/_jsx(\"td\", {\n                \"data-label\": \"Token Pair\",\n                children: \"LINK/USD\"\n              }), /*#__PURE__*/_jsx(\"td\", {\n                \"data-label\": \"Job ID\",\n                children: \"c1d6b9a159c64d3888b0e71104bdbb8d\"\n              })]\n            })\n          }), /*#__PURE__*/_jsx(\"tbody\", {\n            children: /*#__PURE__*/_jsxs(\"tr\", {\n              children: [/*#__PURE__*/_jsx(\"td\", {\n                \"data-label\": \"Token Pair\",\n                children: \"SUSHI/USD\"\n              }), /*#__PURE__*/_jsx(\"td\", {\n                \"data-label\": \"Job ID\",\n                children: \"861c8bd8d92f42d3b21606111173cd4a\"\n              })]\n            })\n          }), /*#__PURE__*/_jsx(\"tbody\", {\n            children: /*#__PURE__*/_jsxs(\"tr\", {\n              children: [/*#__PURE__*/_jsx(\"td\", {\n                \"data-label\": \"Token Pair\",\n                children: \"UNI/USD\"\n              }), /*#__PURE__*/_jsx(\"td\", {\n                \"data-label\": \"Price\",\n                children: \"14ff274fc6ac469bb3a27b34c21c0957\"\n              })]\n            })\n          })]\n        })]\n      });\n    }\n  }], [{\n    key: \"getInitialProps\",\n    // Nextjs uses this function to render this first server-side\n    value: function () {\n      var _getInitialProps = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                getValue();\n\n              case 1:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }));\n\n      function getInitialProps() {\n        return _getInitialProps.apply(this, arguments);\n      }\n\n      return getInitialProps;\n    }()\n  }]);\n\n  return Table;\n}(Component);\n\nexport default Table;","map":null,"metadata":{},"sourceType":"module"}